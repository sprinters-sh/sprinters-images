#!/bin/bash

echo "Patching runner..."
sed -i 's/\x41\x00\x43\x00\x54\x00\x49\x00\x4F\x00\x4E\x00\x53\x00\x5F\x00\x52\x00\x45\x00\x53\x00\x55\x00\x4C\x00\x54\x00\x53\x00\x5F\x00\x55\x00\x52\x00\x4C\x00/\x41\x00\x43\x00\x54\x00\x49\x00\x4F\x00\x4E\x00\x53\x00\x5F\x00\x52\x00\x45\x00\x53\x00\x55\x00\x4C\x00\x54\x00\x53\x00\x5F\x00\x4F\x00\x52\x00\x4C\x00/g' /home/runner/bin/Runner.Worker.dll

echo "Starting Sprinters Agent..."
if [ "$SPRINTERS_AGENT_URL" != "" ]; then
  export ACTIONS_RESULTS_URL=$SPRINTERS_AGENT_URL
  echo "Using custom Sprinters Agent at $ACTIONS_RESULTS_URL ..."
else
  /sprinters-agent/sprinters-agent.sh cache &
  export ACTIONS_RESULTS_URL=http://localhost:31385
fi
